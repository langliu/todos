# AGENTS.md - AI Coding Guidelines

> Guidelines for AI agents working in this TanStack Start application.

## Communication Language

**IMPORTANT**: All AI agents must use Chinese for all communication, responses, and explanations when working on this project. This includes:
- All messages to the user
- Code explanations and comments
- Documentation and descriptions
- Error messages and debugging information

Only technical terms (e.g., React, TypeScript, TanStack) should remain in English.

## Tech Stack

- **Runtime**: Bun | **Framework**: TanStack Start + Router | **UI**: React 19
- **Language**: TypeScript (strict) | **Build**: Vite 7 | **Testing**: Vitest | **Styling**: CSS

## Commands

```bash
bun install                              # Install dependencies
bun --bun run dev                        # Dev server (port 3000)
bun --bun run build                      # Production build
bun --bun run test                       # Run all tests
bun --bun run test src/path/file.test.tsx  # Run single test
bun --bun run test -t "pattern"          # Run tests by name
bun --bun vitest                         # Watch mode
bun tsc --noEmit                         # Type check
```

## Project Structure

```
src/
├── components/       # React components (Component.tsx + Component.css)
├── data/            # Data utilities and server functions
├── routes/          # TanStack Router file-based routes
│   ├── __root.tsx   # Root layout
│   └── index.tsx    # Home page
├── router.tsx       # Router config
├── routeTree.gen.ts # AUTO-GENERATED - DO NOT EDIT
└── styles.css       # Global styles
```

## Import Order

```typescript
import fs from 'node:fs' // 1. Node built-ins
import { useState } from 'react' // 2. React
import { createFileRoute } from '@tanstack/react-router' // 3. TanStack
import { someLib } from 'third-party' // 4. Third-party
import { getData } from '@/data/utils' // 5. Path alias (@/)
import Header from '../components/Header' // 6. Relative imports
import './styles.css' // 7. CSS (last)
```

**Path Alias**: Use `@/` for src-relative imports: `import { x } from '@/data/file'`

## TypeScript Guidelines

- Strict mode enabled - no implicit any, unused locals/parameters
- Explicit types for function parameters
- Use type inference where obvious
- Export types with `export type`

## React Components

```typescript
import { Link } from '@tanstack/react-router'
import './Header.css'

export default function Header() {  // Function declarations, not arrows
  return <header className="header">{/* ... */}</header>
}
```

## TanStack Router Routes

```typescript
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/path')({
  component: RouteComponent,
  loader: async () => await fetchData(),  // Optional
  ssr: 'data-only',                        // Optional: 'data-only' | false
})

function RouteComponent() {
  const data = Route.useLoaderData()
  return <div>{/* ... */}</div>
}
```

## Server Functions

```typescript
import { createServerFn } from '@tanstack/react-start'

const getData = createServerFn({ method: 'GET' }).handler(async () => await fetchFromDB())

const createItem = createServerFn({ method: 'POST' })
  .inputValidator((data: CreateItemInput) => data)
  .handler(async ({ data }) => result)
```

## API Routes

```typescript
import { createFileRoute } from '@tanstack/react-router'
import { json } from '@tanstack/react-start'

export const Route = createFileRoute('/api/endpoint')({
  server: {
    handlers: {
      GET: () => json({ data: 'value' }),
    },
  },
})
```

## Naming Conventions

| Type                | Convention     | Example                  |
| ------------------- | -------------- | ------------------------ |
| Components          | PascalCase     | `Header`, `TodoList`     |
| Functions/Variables | camelCase      | `getTodos`, `isLoading`  |
| CSS classes         | kebab-case     | `nav-item`, `App-header` |
| Component files     | PascalCase.tsx | `Header.tsx`             |
| Route files         | kebab-case.tsx | `start.server-funcs.tsx` |
| Data/util files     | kebab-case.ts  | `demo.punk-songs.ts`     |

## CSS Styling

- Plain CSS files, co-located with components
- Import: `import './Header.css'`
- Use rem units, semantic class names

```css
.header {
  padding: 0.5rem;
  display: flex;
  gap: 0.5rem;
}
```

## Error Handling

```typescript
// Provide fallbacks for async operations
async function readData() {
  return JSON.parse(await fs.promises.readFile(FILE, 'utf-8').catch(() => '[]'))
}
```

## Auto-Generated Files

**DO NOT EDIT**: `src/routeTree.gen.ts` - Generated by TanStack Router

## Testing

```typescript
import { describe, it, expect } from 'vitest'
import { render, screen } from '@testing-library/react'

describe('Component', () => {
  it('renders correctly', () => {
    render(<Component />)
    expect(screen.getByText('text')).toBeInTheDocument()
  })
})
```

File naming: `*.test.tsx` or `*.spec.tsx`
